---
title: "Living conditions in Italy - income distribution and income inequality"
author: "Luca Bartolomei"
date: "_`r format(Sys.Date(), '%d %B, %Y')`_"
output:
  html_document:
    toc: yes
    toc_depth: '3'
    df_print: paged
  pdf_document:
    df_print: kable
    number_sections: yes
    toc: yes
    toc_depth: 3
    fig_caption: yes
    extra_dependencies: subfig
    highlight: tango
classoption: a4paper
fig_height: 5
fig_width: 5
fontsize: 6pt
latex_engine: xelatex
mainfont: Arial
mathfont: LiberationMono
monofont: DejaVu Sans Mono
include-before: '`\newpage{}`{=latex}'
urlcolor: blue
---

\newpage

## **Introduction**

This project has the aim to analyze some indicators useful to describe income 
and living conditions in Italy. Furthermore these indicators will be compared 
with those at European level.

All data comes from Eurostat database

Charts use dynamic data. For this reason, an explanation of the displayed data will not be provided, the trend of which may change from the date of writing of this report


Indicators analyzed:

1.  Persons at risk of poverty or social exclusion by age and sex
2.  Persons at risk of poverty or social exclusion by most frequent activity status
3.  Persons at risk of poverty or social exclusion by income quantile and household composition
4.  Persons at risk of poverty or social exclusion by tenure status
5.  Persons at risk of poverty or social exclusion by degree of urbanisation
6.  Children at risk of poverty or social exclusion by educational attainment level of their parents (population aged     0 to 17 years)
7.  Persons by risk of poverty, material deprivation, work intensity of the household, age and sex of the person
8.  In work at risk of poverty rate by age and sex
9.  In work at risk of poverty rate by type of contract
10. Material and social deprivation rate by age, sex and most frequent activity status
11. Severe material deprivation rate by age and sex
12. Inability to keep home adequately warm
13. Inability to afford a meal with meat, chicken, fish (or vegetarian equivalent) every second day
14. Persons who cannot afford a computer
15. Persons who cannot afford internet connection for personal use at home by age, sex and income group
16. Severe housing deprivation rate by age, sex and poverty status
17. House price index
18. Consumer price index (HICP - annual data (average index and rate of change))
19. Social protection (Expenditure)
20. Social protection (Pensions)
21. General government expenditure by function

## **Key concepts**

***Dwelling***
A dwelling is a room or suite of rooms - including its accessories, lobbies 
and corridors - in a permanent building or a structurally separated part of 
a building which, by the way it has been built, rebuilt or converted, 
is designed for habitation by one private household all year round.

***Household***
A household, in the context of surveys on social conditions or income, 
is defined as a housekeeping unit or, operationally, as a social unit:

  1. having common arrangements;
  2. sharing household expenses or daily needs;
  3. in a shared common residence.

***House price index***
The house price index, abbreviated as HPI, is an index that measures the changes
in the transaction prices of dwellings purchased by households.

***Consumer price index***
The consumer price index, abbreviated as CPI, measures the change over time in 
the prices of consumer goods and services acquired, used or paid for 
by households.

\newpage

## **Results**

```{r Install libraries,echo=FALSE,message=FALSE,warning=FALSE}
if(!require(eurostat)) install.packages("eurostat", repos = "http://cran.us.r-project.org")
if(!require(dplyr)) install.packages("dplyr", repos = "http://cran.us.r-project.org")
if(!require(ggplot2)) install.packages("ggplot2", repos = "http://cran.us.r-project.org")
if(!require(fpp2)) install.packages("fpp2", repos = "http://cran.us.r-project.org")
if(!require(lubridate)) install.packages("lubridate", repos = "http://cran.us.r-project.org")
if(!require(ggplot2)) install.packages("ggplot2", repos = "http://cran.us.r-project.org")
if(!require(plotly)) install.packages("plotly", repos = "http://cran.us.r-project.org")

library(eurostat) # package used for querrying EUROSTAT
library(dplyr) # package used for data-manipulation
library(ggplot2) # package used for plotting
library(fpp2) # package used for forecasting
library(lubridate) #For handling dates
library(ggplot2)   #For plotting of results
library(plotly) #interactive plotting

# clear old variables from memory
rm(list=ls())

age <- c('Y_LT6', 'Y6-10', 'Y6-11', 'Y11-15', 'Y12-17', 'Y15-19', 'Y15-24', 
         'Y15-29', 'Y_LT16', 'Y16-19', 'Y16-24', 'Y16-29', 'Y16-64', 'Y_GE16',
         'Y_LT18', 'Y18-24', 'Y18-29', 'Y18-49', 'Y18-59', 'Y18-64', 'Y18-74', 
         'Y_GE18', 'Y20-24', 'Y20-29', 'Y25-29', 'Y25-34',
         'Y25-49', 'Y25-54', 'Y25-59', 
         'Y35-44', 'Y45-54',
         'Y50-59', 'Y50-64', 'Y55-64', 'Y_GE55', 'Y_LT60', 'Y_GE60',
         'Y_LT65', 'Y65-74', 'Y_GE65', 'Y_LT75', 'Y_GE75', 'Y_GE85')
age_description <- c('Less than 6 years', 'From 6 to 10 years', 'From 6 to 11 years',
                     'From 11 to 15 years', 'From 12 to 17 years', 'From 15 to 19 years',
                     'From 15 to 24 years', 'From 15 to 29 years', 'Less than 16 years',
                     'From 16 to 19 years', 'From 16 to 24 years', 'From 16 to 29 years',
                     'From 16 to 64 years', '16 years or over', 'Less than 18 years',
                     'From 18 to 24 years', 'From 18 to 29 years', 'From 18 to 49 years', 
                     'From 18 to 59 years', 'From 18 to 64 years', 'From 18 to 74 years', '18 years or over',
                     'From 20 to 24 years', 'From 20 to 29 years', 'From 25 to 29 years', 'From 25 to 34 years',
                     'From 25 to 49 years', 'From 25 to 54 years', 'From 25 to 59 years', 
                     'From 35 to 44 years', 'From 45 to 54 years',
                     'From 50 to 59 years', 'From 50 to 64 years',
                     'From 55 to 64 years', '55 years or over', 'Less than 60 years',
                     '60 years or over',
                     'Less than 65 years', 'From 65 to 74 years', '65 years or over',
                     'Less than 75 years', '75 years or over', '85 years or over')

df_age <- data.frame(age, age_description)

getAgeDescription <- function(age_value) {
  df_age %>% filter(age == age_value)
}
```

### Persons at risk of poverty or social exclusion by age and sex

```{r Persons at risk of poverty or social exclusion by age and sex - EU 2020 strategy,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}

dt_ilc_peps01 <- get_eurostat("ilc_peps01", stringsAsFactors = FALSE)

dt_ilc_peps01_it <- dt_ilc_peps01 %>% filter(geo == 'IT')

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% filter(unit == 'PC')

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% filter(sex == 'F')

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% mutate(year = year(time))

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% select(age, year, values)

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% filter(age != 'TOTAL')

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_peps01_it[[4]][dt_ilc_peps01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% select(age_description, year, values)

colnames(dt_ilc_peps01_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_peps01_it, aes(year, values, color=age)) +
    ggtitle('Italy - Women at risk of poverty or social exclusion by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_peps01_it <- dt_ilc_peps01 %>% filter(geo == 'IT')

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% filter(unit == 'PC')

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% filter(sex == 'M')

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% mutate(year = year(time))

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% select(age, year, values)

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% filter(age != 'TOTAL')

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_peps01_it[[4]][dt_ilc_peps01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_peps01_it <- dt_ilc_peps01_it %>% select(age_description, year, values)

colnames(dt_ilc_peps01_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_peps01_it, aes(year, values, color=age)) +
    ggtitle('Italy - Men at risk of poverty or social exclusion by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_peps01_eu <- dt_ilc_peps01 %>% filter(geo == 'EU')

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% filter(unit == 'PC')

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% filter(sex == 'F')

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% mutate(year = year(time))

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% select(age, year, values)

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% filter(age != 'TOTAL')

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_peps01_eu[[4]][dt_ilc_peps01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% select(age_description, year, values)

colnames(dt_ilc_peps01_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_peps01_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Women at risk of poverty or social exclusion by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_peps01_eu <- dt_ilc_peps01 %>% filter(geo == 'EU')

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% filter(unit == 'PC')

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% filter(sex == 'M')

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% mutate(year = year(time))

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% select(age, year, values)

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% filter(age != 'TOTAL')

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_peps01_eu[[4]][dt_ilc_peps01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_peps01_eu <- dt_ilc_peps01_eu %>% select(age_description, year, values)

colnames(dt_ilc_peps01_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_peps01_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Men at risk of poverty or social exclusion by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Persons at risk of poverty or social exclusion by most frequent activity status

```{r Persons at risk of poverty or social exclusion by most frequent activity status (population aged 18 and over) - EU 2020 strategy Unemployed persons,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_peps02 <- get_eurostat("ilc_peps02", stringsAsFactors = FALSE)

dt_ilc_peps02_it <- dt_ilc_peps02 %>% filter(geo == 'IT')

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% filter(sex == 'F') 

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% filter(age == 'Y_GE18') 

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% mutate(year = year(time))

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% select(wstatus, year, values)

dt_ilc_peps02_it <- dt_ilc_peps02_it %>%
  mutate(status = case_when(
    .$wstatus == 'POP' ~ 'Population',
    .$wstatus == 'EMP' ~ 'Employed persons',
    .$wstatus == 'SAL' ~ 'Employees',
    .$wstatus == 'NSAL' ~ 'Employed persons except employees',
    .$wstatus == 'NEMP' ~ 'Not employed persons',
    .$wstatus == 'UNE' ~ 'Unemployed persons',
    .$wstatus == 'RET' ~ 'Retired persons',
    TRUE ~ 'Other persons outside the labour force (former name: inactive persons)'))

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% select(status, year, values)

ggplotly(
  ggplot(dt_ilc_peps02_it, aes(year, values, color=status)) +
    ggtitle('Italy - Women (18 years or over) at risk of poverty or social exclusion by most frequent activity status') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_peps02_it <- dt_ilc_peps02 %>% filter(geo == 'IT')

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% filter(sex == 'F') 

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% filter(wstatus == 'UNE') 

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% mutate(year = year(time))

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% select(age, year, values)

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_peps02_it[[4]][dt_ilc_peps02_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% select(age_description, year, values)

colnames(dt_ilc_peps02_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_peps02_it, aes(year, values, color=age)) +
    ggtitle('Italy - Unemployed women (18 years or over) at risk of poverty or social exclusion by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_peps02_it <- dt_ilc_peps02 %>% filter(geo == 'IT')

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% filter(sex == 'M') 

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% filter(age == 'Y_GE18') 

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% mutate(year = year(time))

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% select(wstatus, year, values)

dt_ilc_peps02_it <- dt_ilc_peps02_it %>%
  mutate(status = case_when(
    .$wstatus == 'POP' ~ 'Population',
    .$wstatus == 'EMP' ~ 'Employed persons',
    .$wstatus == 'SAL' ~ 'Employees',
    .$wstatus == 'NSAL' ~ 'Employed persons except employees',
    .$wstatus == 'NEMP' ~ 'Not employed persons',
    .$wstatus == 'UNE' ~ 'Unemployed persons',
    .$wstatus == 'RET' ~ 'Retired persons',
    TRUE ~ 'Other persons outside the labour force (former name: inactive persons)'))

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% select(status, year, values)

ggplotly(
  ggplot(dt_ilc_peps02_it, aes(year, values, color=status)) +
    ggtitle('Italy - Men (18 years or over) at risk of poverty or social exclusion by most frequent activity status') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_peps02_it <- dt_ilc_peps02 %>% filter(geo == 'IT')

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% filter(sex == 'M') 

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% filter(wstatus == 'UNE') 

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% mutate(year = year(time))

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% select(age, year, values)

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_peps02_it[[4]][dt_ilc_peps02_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_peps02_it <- dt_ilc_peps02_it %>% select(age_description, year, values)

colnames(dt_ilc_peps02_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_peps02_it, aes(year, values, color=age)) +
    ggtitle('Italy - Unemployed men (18 years or over) at risk of poverty or social exclusion by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_peps02_eu <- dt_ilc_peps02 %>% filter(geo == 'EU')

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% filter(sex == 'F') 

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% filter(age == 'Y_GE18') 

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% mutate(year = year(time))

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% select(wstatus, year, values)

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>%
  mutate(status = case_when(
    .$wstatus == 'POP' ~ 'Population',
    .$wstatus == 'EMP' ~ 'Employed persons',
    .$wstatus == 'SAL' ~ 'Employees',
    .$wstatus == 'NSAL' ~ 'Employed persons except employees',
    .$wstatus == 'NEMP' ~ 'Not employed persons',
    .$wstatus == 'UNE' ~ 'Unemployed persons',
    .$wstatus == 'RET' ~ 'Retired persons',
    TRUE ~ 'Other persons outside the labour force (former name: inactive persons)'))

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% select(status, year, values)

ggplotly(
  ggplot(dt_ilc_peps02_eu, aes(year, values, color=status)) +
    ggtitle('Europe - Women (18 years or over) at risk of poverty or social exclusion by most frequent activity status') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_peps02_eu <- dt_ilc_peps02 %>% filter(geo == 'EU')

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% filter(sex == 'F') 

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% filter(wstatus == 'UNE') 

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% mutate(year = year(time))

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% select(age, year, values)

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_peps02_eu[[4]][dt_ilc_peps02_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% select(age_description, year, values)

colnames(dt_ilc_peps02_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_peps02_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Unemployed women (18 years or over) at risk of poverty or social exclusion by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_peps02_eu <- dt_ilc_peps02 %>% filter(geo == 'EU')

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% filter(sex == 'M') 

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% filter(age == 'Y_GE18') 

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% mutate(year = year(time))

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% select(wstatus, year, values)

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>%
  mutate(status = case_when(
    .$wstatus == 'POP' ~ 'Population',
    .$wstatus == 'EMP' ~ 'Employed persons',
    .$wstatus == 'SAL' ~ 'Employees',
    .$wstatus == 'NSAL' ~ 'Employed persons except employees',
    .$wstatus == 'NEMP' ~ 'Not employed persons',
    .$wstatus == 'UNE' ~ 'Unemployed persons',
    .$wstatus == 'RET' ~ 'Retired persons',
    TRUE ~ 'Other persons outside the labour force (former name: inactive persons)'))

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% select(status, year, values)

ggplotly(
  ggplot(dt_ilc_peps02_eu, aes(year, values, color=status)) +
    ggtitle('Europe - Men (18 years or over) at risk of poverty or social exclusion by most frequent activity status') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
  )

dt_ilc_peps02_eu <- dt_ilc_peps02 %>% filter(geo == 'EU')

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% filter(sex == 'M') 

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% filter(wstatus == 'UNE') 

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% mutate(year = year(time))

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% select(age, year, values)

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_peps02_eu[[4]][dt_ilc_peps02_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_peps02_eu <- dt_ilc_peps02_eu %>% select(age_description, year, values)

colnames(dt_ilc_peps02_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_peps02_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Unemployed men (18 years or over) at risk of poverty or social exclusion by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Persons at risk of poverty or social exclusion by income quantile and household composition

```{r Persons at risk of poverty or social exclusion by income quantile and household composition - EU 2020 strategy,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_peps03 <- get_eurostat("ilc_peps03", stringsAsFactors = FALSE)

dt_ilc_peps03_it <- dt_ilc_peps03 %>% filter(geo == 'IT')

dt_ilc_peps03_it <- dt_ilc_peps03_it %>% filter(quantile == 'TOTAL') 

dt_ilc_peps03_it <- dt_ilc_peps03_it %>% mutate(year = year(time))

dt_ilc_peps03_it <- dt_ilc_peps03_it %>% select(hhtyp, year, values)

dt_ilc_peps03_it <- dt_ilc_peps03_it %>%
  mutate(household_composition = case_when(
    .$hhtyp == 'A1' ~ 'Single person',
    .$hhtyp == 'A1_LT65' ~ 'One adult younger than 65 years',
    .$hhtyp == 'A1_GE65' ~ 'One adult 65 years or over',
    .$hhtyp == 'A1_DCH' ~ 'Single person with dependent children',
    .$hhtyp == 'A1F' ~ 'Single female',
    .$hhtyp == 'A1M' ~ 'Single male',
    .$hhtyp == 'A2' ~ 'Two adults',
    .$hhtyp == 'A2_2LT65' ~ 'Two adults younger than 65 years',
    .$hhtyp == 'A2_GE1_GE65' ~ 'Two adults, at least one aged 65 years or over',
    .$hhtyp == 'A2_1DCH' ~ 'Two adults with one dependent child',
    .$hhtyp == 'A2_2DCH' ~ 'Two adults with two dependent children',
    .$hhtyp == 'A2_GE3DCH' ~ 'Two adults with three or more dependent children',
    .$hhtyp == 'A_GE2_NDCH' ~ 'Two or more adults without dependent children',
    .$hhtyp == 'A_GE2_DCH' ~ 'Two or more adults with dependent children',
    .$hhtyp == 'A_GE3' ~ 'Three or more adults',
    .$hhtyp == 'A_GE3_DCH' ~ 'Three or more adults with dependent children',
    .$hhtyp == 'HH_NDCH' ~ 'Households without dependent children',
    TRUE ~ 'Households with dependent children'))

dt_ilc_peps03_it <- dt_ilc_peps03_it %>% select(household_composition, year, values)

ggplotly(
  ggplot(dt_ilc_peps03_it, aes(year, values, color=household_composition)) +
    ggtitle('Italy - Persons at risk of poverty or social exclusion by household composition') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_peps03_eu <- dt_ilc_peps03 %>% filter(geo == 'EU')

dt_ilc_peps03_eu <- dt_ilc_peps03_eu %>% filter(quantile == 'TOTAL') 

dt_ilc_peps03_eu <- dt_ilc_peps03_eu %>% mutate(year = year(time))

dt_ilc_peps03_eu <- dt_ilc_peps03_eu %>% select(hhtyp, year, values)

dt_ilc_peps03_eu <- dt_ilc_peps03_eu %>%
  mutate(household_composition = case_when(
    .$hhtyp == 'A1' ~ 'Single person',
    .$hhtyp == 'A1_LT65' ~ 'One adult younger than 65 years',
    .$hhtyp == 'A1_GE65' ~ 'One adult 65 years or over',
    .$hhtyp == 'A1_DCH' ~ 'Single person with dependent children',
    .$hhtyp == 'A1F' ~ 'Single female',
    .$hhtyp == 'A1M' ~ 'Single male',
    .$hhtyp == 'A2' ~ 'Two adults',
    .$hhtyp == 'A2_2LT65' ~ 'Two adults younger than 65 years',
    .$hhtyp == 'A2_GE1_GE65' ~ 'Two adults, at least one aged 65 years or over',
    .$hhtyp == 'A2_1DCH' ~ 'Two adults with one dependent child',
    .$hhtyp == 'A2_2DCH' ~ 'Two adults with two dependent children',
    .$hhtyp == 'A2_GE3DCH' ~ 'Two adults with three or more dependent children',
    .$hhtyp == 'A_GE2_NDCH' ~ 'Two or more adults without dependent children',
    .$hhtyp == 'A_GE2_DCH' ~ 'Two or more adults with dependent children',
    .$hhtyp == 'A_GE3' ~ 'Three or more adults',
    .$hhtyp == 'A_GE3_DCH' ~ 'Three or more adults with dependent children',
    .$hhtyp == 'HH_NDCH' ~ 'Households without dependent children',
    TRUE ~ 'Households with dependent children'))

dt_ilc_peps03_eu <- dt_ilc_peps03_eu %>% select(household_composition, year, values)

ggplotly(
  ggplot(dt_ilc_peps03_eu, aes(year, values, color=household_composition)) +
    ggtitle('Europe - Persons at risk of poverty or social exclusion by household composition') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Persons at risk of poverty or social exclusion by tenure status

```{r Persons at risk of poverty or social exclusion by tenure status - EU 2020 strategy,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_peps07 <- get_eurostat("ilc_peps07", stringsAsFactors = FALSE)

dt_ilc_peps07_it <- dt_ilc_peps07 %>% filter(geo == 'IT')

dt_ilc_peps07_it <- dt_ilc_peps07_it %>% filter(unit == 'PC') 

dt_ilc_peps07_it <- dt_ilc_peps07_it %>% mutate(year = year(time))

dt_ilc_peps07_it <- dt_ilc_peps07_it %>% select(tenure, year, values)

dt_ilc_peps07_it <- dt_ilc_peps07_it %>% filter(tenure != 'TOTAL')

dt_ilc_peps07_it <- dt_ilc_peps07_it %>%
  mutate(tenure_status = case_when(
    .$tenure == 'OWN_L' ~ 'Owner, with mortgage or loann',
    .$tenure == 'OWN_NL' ~ 'Owner, no outstanding mortgage or housing loan',
    .$tenure == 'RENT_MKT' ~ 'Tenant, rent at market price',
    TRUE ~ 'Tenant, rent at reduced price or free'))

dt_ilc_peps07_it <- dt_ilc_peps07_it %>% select(tenure_status, year, values)

ggplotly(
  ggplot(dt_ilc_peps07_it, aes(year, values, color=tenure_status)) +
    geom_smooth(formula = y ~ x, method = "lm") +
    ggtitle('Italy - Persons at risk of poverty or social exclusion by tenure status') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_peps07_eu <- dt_ilc_peps07 %>% filter(geo == 'EU')

dt_ilc_peps07_eu <- dt_ilc_peps07_eu %>% filter(unit == 'PC') 

dt_ilc_peps07_eu <- dt_ilc_peps07_eu %>% mutate(year = year(time))

dt_ilc_peps07_eu <- dt_ilc_peps07_eu %>% select(tenure, year, values)

dt_ilc_peps07_eu <- dt_ilc_peps07_eu %>% filter(tenure != 'TOTAL')

dt_ilc_peps07_eu <- dt_ilc_peps07_eu %>%
  mutate(tenure_status = case_when(
    .$tenure == 'OWN_L' ~ 'Owner, with mortgage or loann',
    .$tenure == 'OWN_NL' ~ 'Owner, no outstanding mortgage or housing loan',
    .$tenure == 'RENT_MKT' ~ 'Tenant, rent at market price',
    TRUE ~ 'Tenant, rent at reduced price or free'))

dt_ilc_peps07_eu <- dt_ilc_peps07_eu %>% select(tenure_status, year, values)

ggplotly(
  ggplot(dt_ilc_peps07_eu, aes(year, values, color=tenure_status)) +
    geom_smooth(formula = y ~ x, method = "lm") +
    ggtitle('Europe - Persons at risk of poverty or social exclusion by tenure status') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Persons at risk of poverty or social exclusion by degree of urbanisation

```{r Persons at risk of poverty or social exclusion by degree of urbanisation - EU 2020 strategy,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_peps13 <- get_eurostat("ilc_peps13", stringsAsFactors = FALSE)

dt_ilc_peps13_it <- dt_ilc_peps13 %>% filter(geo == 'IT')

dt_ilc_peps13_it <- dt_ilc_peps13_it %>% filter(unit == 'PC') 

dt_ilc_peps13_it <- dt_ilc_peps13_it %>% mutate(year = year(time))

dt_ilc_peps13_it <- dt_ilc_peps13_it %>% select(deg_urb, year, values)

dt_ilc_peps13_it <- dt_ilc_peps13_it %>%
  mutate(urbanisation_degree = case_when(
    .$deg_urb == 'DEG1' ~ 'Cities',
    .$deg_urb == 'DEG2' ~ 'Towns and suburbs',
    TRUE ~ 'Rural areas'))

dt_ilc_peps13_it <- dt_ilc_peps13_it %>% select(urbanisation_degree, year, values)

ggplotly(
  ggplot(dt_ilc_peps13_it, aes(year, values, color=urbanisation_degree)) +
    geom_smooth(formula = y ~ x, method = "lm") +
    ggtitle('Italy - Persons at risk of poverty or social exclusion by degree of urbanisation') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_peps13_eu <- dt_ilc_peps13 %>% filter(geo == 'EU')

dt_ilc_peps13_eu <- dt_ilc_peps13_eu %>% filter(unit == 'PC') 

dt_ilc_peps13_eu <- dt_ilc_peps13_eu %>% mutate(year = year(time))

dt_ilc_peps13_eu <- dt_ilc_peps13_eu %>% select(deg_urb, year, values)

dt_ilc_peps13_eu <- dt_ilc_peps13_eu %>% select(deg_urb, year, values)

dt_ilc_peps13_eu <- dt_ilc_peps13_eu %>%
  mutate(urbanisation_degree = case_when(
    .$deg_urb == 'DEG1' ~ 'Cities',
    .$deg_urb == 'DEG2' ~ 'Towns and suburbs',
    TRUE ~ 'Rural areas'))

ggplotly(
  ggplot(dt_ilc_peps13_eu, aes(year, values, color=urbanisation_degree)) +
    geom_smooth(formula = y ~ x, method = "lm") +
    ggtitle('Europe - Persons at risk of poverty or social exclusion by degree of urbanisation') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Children at risk of poverty or social exclusion by educational attainment level of their parents (population aged 0 to 17 years)

```{r Children at risk of poverty or social exclusion by educational attainment level of their parents (population aged 0 to 17 years) - EU 2020 strategy,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_peps60 <- get_eurostat("ilc_peps60", stringsAsFactors = FALSE)

dt_ilc_peps60_it <- dt_ilc_peps60 %>% filter(geo == 'IT')

dt_ilc_peps60_it <- dt_ilc_peps60_it %>% filter(age == 'Y_LT18') 

dt_ilc_peps60_it <- dt_ilc_peps60_it %>% mutate(year = year(time))

dt_ilc_peps60_it <- dt_ilc_peps60_it %>% select(isced11, year, values)

dt_ilc_peps60_it <- dt_ilc_peps60_it %>%
  mutate(educational_attainment = case_when(
    .$isced11 == 'ED0-2' ~ 'Less than primary, primary and lower secondary education (levels 0-2)',
    .$isced11 == 'ED3_4' ~ 'Upper secondary and post-secondary non-tertiary education (levels 3 and 4)',
    TRUE ~ 'Tertiary education (levels 5-8)'))

dt_ilc_peps60_it <- dt_ilc_peps60_it %>% select(educational_attainment, year, values)

ggplotly(
  ggplot(dt_ilc_peps60_it, aes(year, values, color=educational_attainment)) +
    geom_smooth(formula = y ~ x, method = "lm") +
    ggtitle('Italy - Children at risk of poverty or social exclusion by educational attainment level of their parents') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_peps60_eu <- dt_ilc_peps60 %>% filter(geo == 'EU')

dt_ilc_peps60_eu <- dt_ilc_peps60_eu %>% filter(age == 'Y_LT18') 

dt_ilc_peps60_eu <- dt_ilc_peps60_eu %>% mutate(year = year(time))

dt_ilc_peps60_eu <- dt_ilc_peps60_eu %>% select(isced11, year, values)

dt_ilc_peps60_eu <- dt_ilc_peps60_eu %>%
  mutate(educational_attainment = case_when(
    .$isced11 == 'ED0-2' ~ 'Less than primary, primary and lower secondary education (levels 0-2)',
    .$isced11 == 'ED3_4' ~ 'Upper secondary and post-secondary non-tertiary education (levels 3 and 4)',
    TRUE ~ 'Tertiary education (levels 5-8)'))

dt_ilc_peps60_eu <- dt_ilc_peps60_eu %>% select(educational_attainment, year, values)

ggplotly(
  ggplot(dt_ilc_peps60_eu, aes(year, values, color=educational_attainment)) +
    geom_smooth(formula = y ~ x, method = "lm") +
    ggtitle('Europe - Children at risk of poverty or social exclusion by educational attainment level of their parents') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Persons by risk of poverty, material deprivation, work intensity of the household, age and sex of the person

```{r Persons by risk of poverty, material deprivation, work intensity of the household, age and sex of the person - intersections of EU 2020 Strategy poverty target indicator,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_pees01 <- get_eurostat("ilc_pees01", stringsAsFactors = FALSE)

dt_ilc_pees01_it <- dt_ilc_pees01 %>% filter(geo == 'IT')

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(unit == 'PC') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(sex == 'F') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(lev_depr == 'SEV') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(yn_rskpov == 'YES_ARP') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% mutate(year = year(time))

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% select(workint, age, year, values)

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(age == 'TOTAL')

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% select(workint, year, values)

dt_ilc_pees01_it <- dt_ilc_pees01_it %>%
  mutate(work_intensity = case_when(
    .$workint == 'WI02-1_NAP' ~ 'Not very low work intensity (0.2-1) and not applicable',
    TRUE ~ 'Very low work intensity (0-0.2)'))

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% select(work_intensity, year, values)

ggplotly(
  ggplot(dt_ilc_pees01_it, aes(year, values, color=work_intensity)) +
    ggtitle('Italy - Women at risk of poverty, material deprivation, work intensity of the household') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_pees01_it <- dt_ilc_pees01 %>% filter(geo == 'IT')

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(unit == 'PC') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(sex == 'F') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(lev_depr == 'SEV') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(yn_rskpov == 'YES_ARP') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% mutate(year = year(time))

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(workint == 'WI02-1_NAP')

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% select(age, year, values)

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_pees01_it[[4]][dt_ilc_pees01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% select(age_description, year, values)

colnames(dt_ilc_pees01_it) <- c('age', 'year', 'values')

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(age != 'TOTAL')

ggplotly(
  ggplot(dt_ilc_pees01_it, aes(year, values, color=age)) +
    ggtitle('Italy - Women at risk of poverty, with not very low household work intensity and material deprivation, by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_pees01_it <- dt_ilc_pees01 %>% filter(geo == 'IT')

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(unit == 'PC') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(sex == 'M') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(lev_depr == 'SEV') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(yn_rskpov == 'YES_ARP') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% mutate(year = year(time))

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% select(workint, age, year, values)

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(age == 'TOTAL')

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% select(workint, year, values)

dt_ilc_pees01_it <- dt_ilc_pees01_it %>%
  mutate(work_intensity = case_when(
    .$workint == 'WI02-1_NAP' ~ 'Not very low work intensity (0.2-1) and not applicable',
    TRUE ~ 'Very low work intensity (0-0.2)'))

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% select(work_intensity, year, values)

ggplotly(
  ggplot(dt_ilc_pees01_it, aes(year, values, color=work_intensity)) +
    ggtitle('Italy - Men at risk of poverty, material deprivation, work intensity of the household') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_pees01_it <- dt_ilc_pees01 %>% filter(geo == 'IT')

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(unit == 'PC') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(sex == 'M') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(lev_depr == 'SEV') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(yn_rskpov == 'YES_ARP') 

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% mutate(year = year(time))

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(workint == 'WI02-1_NAP')

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% select(age, year, values)

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_pees01_it[[4]][dt_ilc_pees01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% select(age_description, year, values)

colnames(dt_ilc_pees01_it) <- c('age', 'year', 'values')

dt_ilc_pees01_it <- dt_ilc_pees01_it %>% filter(age != 'TOTAL')

ggplotly(
  ggplot(dt_ilc_pees01_it, aes(year, values, color=age)) +
    ggtitle('Italy - Men at risk of poverty, with not very low household work intensity and material deprivation, by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_pees01_eu <- dt_ilc_pees01 %>% filter(geo == 'EU')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(unit == 'PC') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(sex == 'F') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(lev_depr == 'SEV') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(yn_rskpov == 'YES_ARP') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% mutate(year = year(time))

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% select(workint, age, year, values)

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(age == 'TOTAL')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(age == 'TOTAL')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% select(workint, year, values)

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>%
  mutate(work_intensity = case_when(
    .$workint == 'WI02-1_NAP' ~ 'Not very low work intensity (0.2-1) and not applicable',
    TRUE ~ 'Very low work intensity (0-0.2)'))

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% select(work_intensity, year, values)

ggplotly(
  ggplot(dt_ilc_pees01_eu, aes(year, values, color=work_intensity)) +
    geom_smooth(formula = y ~ x, method = "lm") +
    ggtitle('Europe - Women at risk of poverty, material deprivation, work intensity of the household') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_pees01_eu <- dt_ilc_pees01 %>% filter(geo == 'EU')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(unit == 'PC') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(sex == 'F') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(lev_depr == 'SEV') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(yn_rskpov == 'YES_ARP') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% mutate(year = year(time))

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(workint == 'WI02-1_NAP')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% select(age, year, values)

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_pees01_eu[[4]][dt_ilc_pees01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% select(age_description, year, values)

colnames(dt_ilc_pees01_eu) <- c('age', 'year', 'values')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(age != 'TOTAL')

ggplotly(
  ggplot(dt_ilc_pees01_eu, aes(year, values, color=age)) +
    geom_smooth(formula = y ~ x, method = "lm") +
    ggtitle('Europe - Women at risk of poverty, with not very low household work intensity and material deprivation, by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_pees01_eu <- dt_ilc_pees01 %>% filter(geo == 'EU')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(unit == 'PC') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(sex == 'M') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(lev_depr == 'SEV') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(yn_rskpov == 'YES_ARP') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% mutate(year = year(time))

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% select(workint, age, year, values)

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(age == 'TOTAL')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% select(workint, year, values)

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>%
  mutate(work_intensity = case_when(
    .$workint == 'WI02-1_NAP' ~ 'Not very low work intensity (0.2-1) and not applicable',
    TRUE ~ 'Very low work intensity (0-0.2)'))

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% select(work_intensity, year, values)

ggplotly(
  ggplot(dt_ilc_pees01_eu, aes(year, values, color=work_intensity)) +
    geom_smooth(formula = y ~ x, method = "lm") +
    ggtitle('Europe - Men at risk of poverty, material deprivation, work intensity of the household') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_pees01_eu <- dt_ilc_pees01 %>% filter(geo == 'EU')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(unit == 'PC') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(sex == 'M') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(lev_depr == 'SEV') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(yn_rskpov == 'YES_ARP') 

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% mutate(year = year(time))

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(workint == 'WI02-1_NAP')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% select(age, year, values)

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_pees01_eu[[4]][dt_ilc_pees01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% select(age_description, year, values)

colnames(dt_ilc_pees01_eu) <- c('age', 'year', 'values')

dt_ilc_pees01_eu <- dt_ilc_pees01_eu %>% filter(age != 'TOTAL')

ggplotly(
  ggplot(dt_ilc_pees01_eu, aes(year, values, color=age)) +
    geom_smooth(formula = y ~ x, method = "lm") +
    ggtitle('Europe - Men at risk of poverty, with not very low household work intensity and material deprivation, by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### In work at risk of poverty rate by age and sex

```{r In-work at-risk-of-poverty rate by age and sex - EU-SILC survey,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_iw01 <- get_eurostat("ilc_iw01", stringsAsFactors = FALSE)

dt_ilc_iw01_it <- dt_ilc_iw01 %>% filter(geo == 'IT')

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(sex == 'F') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(wstatus == 'EMP') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(year = year(time))

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age, year, values)

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_it[[4]][dt_ilc_iw01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age_description, year, values)

colnames(dt_ilc_iw01_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_it %>% filter(age != 'From 16 to 19 years'), aes(year, values, color=age)) +
    ggtitle('Italy - Employed women at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)



dt_ilc_iw01_it <- dt_ilc_iw01 %>% filter(geo == 'IT')

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(sex == 'M') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(wstatus == 'EMP') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(year = year(time))

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age, year, values)

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_it[[4]][dt_ilc_iw01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age_description, year, values)

colnames(dt_ilc_iw01_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_it %>% filter(age != 'From 16 to 19 years'), aes(year, values, color=age)) +
    ggtitle('Italy - Employed men at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)



dt_ilc_iw01_it <- dt_ilc_iw01 %>% filter(geo == 'IT')

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(sex == 'F') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(wstatus == 'SAL') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(year = year(time))

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age, year, values)

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_it[[4]][dt_ilc_iw01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age_description, year, values)

colnames(dt_ilc_iw01_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_it %>% filter(age != '65 years or over'), aes(year, values, color=age)) +
    ggtitle('Italy - Employees women at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_iw01_it <- dt_ilc_iw01 %>% filter(geo == 'IT')

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(sex == 'M') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(wstatus == 'SAL') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(year = year(time))

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age, year, values)

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_it[[4]][dt_ilc_iw01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age_description, year, values)

colnames(dt_ilc_iw01_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_it %>% filter(age != '65 years or over'), aes(year, values, color=age)) +
    ggtitle('Italy - Employees men at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)




dt_ilc_iw01_it <- dt_ilc_iw01 %>% filter(geo == 'IT')

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(sex == 'F') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(wstatus == 'NSAL') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(year = year(time))

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age, year, values)

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_it[[4]][dt_ilc_iw01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age_description, year, values)

colnames(dt_ilc_iw01_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_it %>% filter(age != 'From 16 to 24 years') %>% 
           filter(age != 'From 18 to 24 years') %>% 
           filter(age != 'From 20 to 24 years'), aes(year, values, color=age)) +
    ggtitle('Italy - Employed women except employees at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_iw01_it <- dt_ilc_iw01 %>% filter(geo == 'IT')

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(sex == 'M') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% filter(wstatus == 'NSAL') 

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(year = year(time))

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age, year, values)

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_it[[4]][dt_ilc_iw01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_it <- dt_ilc_iw01_it %>% select(age_description, year, values)

colnames(dt_ilc_iw01_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_it %>% filter(age != 'From 16 to 24 years') %>% 
           filter(age != 'From 18 to 24 years') %>% 
           filter(age != 'From 20 to 24 years'), aes(year, values, color=age)) +
    ggtitle('Italy - Employed men except employees at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_iw01_eu <- dt_ilc_iw01 %>% filter(geo == 'EU')

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(sex == 'F') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(wstatus == 'EMP') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(year = year(time))

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age, year, values)

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_eu[[4]][dt_ilc_iw01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age_description, year, values)

colnames(dt_ilc_iw01_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_eu %>% filter(age != '65 years or over'), aes(year, values, color=age)) +
    ggtitle('Europe - Employed women at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_iw01_eu <- dt_ilc_iw01 %>% filter(geo == 'EU')

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(sex == 'M') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(wstatus == 'EMP') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(year = year(time))

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age, year, values)

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_eu[[4]][dt_ilc_iw01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age_description, year, values)

colnames(dt_ilc_iw01_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_eu %>% filter(age != 'From 16 to 19 years'), aes(year, values, color=age)) +
    ggtitle('Europe - Employed men at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_iw01_eu <- dt_ilc_iw01 %>% filter(geo == 'EU')

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(sex == 'F') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(wstatus == 'SAL') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(year = year(time))

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age, year, values)

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_eu[[4]][dt_ilc_iw01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age_description, year, values)

colnames(dt_ilc_iw01_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Employees women at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_iw01_eu <- dt_ilc_iw01 %>% filter(geo == 'EU')

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(sex == 'M') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(wstatus == 'SAL') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(year = year(time))

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age, year, values)

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_eu[[4]][dt_ilc_iw01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age_description, year, values)

colnames(dt_ilc_iw01_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_eu %>% filter(age != 'From 16 to 19 years') %>% filter(age != '65 years or over'), aes(year, values, color=age)) +
    ggtitle('Europe - Employees men at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_iw01_eu <- dt_ilc_iw01 %>% filter(geo == 'EU')

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(sex == 'F') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(wstatus == 'NSAL') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(year = year(time))

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age, year, values)

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_eu[[4]][dt_ilc_iw01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age_description, year, values)

colnames(dt_ilc_iw01_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Employed women except employees at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_iw01_eu <- dt_ilc_iw01 %>% filter(geo == 'EU')

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(sex == 'M') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% filter(wstatus == 'NSAL') 

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(year = year(time))

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age, year, values)

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_iw01_eu[[4]][dt_ilc_iw01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_iw01_eu <- dt_ilc_iw01_eu %>% select(age_description, year, values)

colnames(dt_ilc_iw01_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_iw01_eu %>% filter(age != 'From 16 to 29 years')
         %>% filter(age != 'From 20 to 29 years')
         %>% filter(age != '65 years or over'), aes(year, values, color=age)) +
    ggtitle('Europe - Employed men except employees at risk of poverty rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### In work at risk of poverty rate by type of contract

```{r In-work at-risk-of-poverty rate by type of contract - EU-SILC survey,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_iw05 <- get_eurostat("ilc_iw05", stringsAsFactors = FALSE)

dt_ilc_iw05_it <- dt_ilc_iw05 %>% filter(geo == 'IT')

dt_ilc_iw05_it <- dt_ilc_iw05_it %>% filter(sex == 'F') 

dt_ilc_iw05_it <- dt_ilc_iw05_it %>% mutate(year = year(time))

dt_ilc_iw05_it <- dt_ilc_iw05_it %>% select(wstatus, year, values)

dt_ilc_iw05_it <- dt_ilc_iw05_it %>%
  mutate(contract_type = case_when(
    .$wstatus == 'SAL_PERM' ~ 'Employees with a permanent job',
    TRUE ~ 'Employees with a temporary job'))

dt_ilc_iw05_it <- dt_ilc_iw05_it %>% select(contract_type, year, values)

ggplotly(
  ggplot(dt_ilc_iw05_it, aes(year, values, color=contract_type)) +
    ggtitle('Italy - Women at risk of poverty rate by contract type') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_iw05_it <- dt_ilc_iw05 %>% filter(geo == 'IT')

dt_ilc_iw05_it <- dt_ilc_iw05_it %>% filter(sex == 'M') 

dt_ilc_iw05_it <- dt_ilc_iw05_it %>% mutate(year = year(time))

dt_ilc_iw05_it <- dt_ilc_iw05_it %>% select(wstatus, year, values)

dt_ilc_iw05_it <- dt_ilc_iw05_it %>%
  mutate(contract_type = case_when(
    .$wstatus == 'SAL_PERM' ~ 'Employees with a permanent job',
    TRUE ~ 'Employees with a temporary job'))

dt_ilc_iw05_it <- dt_ilc_iw05_it %>% select(contract_type, year, values)

ggplotly(
  ggplot(dt_ilc_iw05_it, aes(year, values, color=contract_type)) +
    ggtitle('Italy - Men at risk of poverty rate by contract type') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_iw05_eu <- dt_ilc_iw05 %>% filter(geo == 'EU')

dt_ilc_iw05_eu <- dt_ilc_iw05_eu %>% filter(sex == 'F') 

dt_ilc_iw05_eu <- dt_ilc_iw05_eu %>% mutate(year = year(time))

dt_ilc_iw05_eu <- dt_ilc_iw05_eu %>% select(wstatus, year, values)

dt_ilc_iw05_eu <- dt_ilc_iw05_eu %>%
  mutate(contract_type = case_when(
    .$wstatus == 'SAL_PERM' ~ 'Employees with a permanent job',
    TRUE ~ 'Employees with a temporary job'))

dt_ilc_iw05_eu <- dt_ilc_iw05_eu %>% select(contract_type, year, values)

ggplotly(
  ggplot(dt_ilc_iw05_eu, aes(year, values, color=contract_type)) +
    ggtitle('Europe - Women at risk of poverty rate by contract type') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_iw05_eu <- dt_ilc_iw05 %>% filter(geo == 'EU')

dt_ilc_iw05_eu <- dt_ilc_iw05_eu %>% filter(sex == 'M') 

dt_ilc_iw05_eu <- dt_ilc_iw05_eu %>% mutate(year = year(time))

dt_ilc_iw05_eu <- dt_ilc_iw05_eu %>% select(wstatus, year, values)

dt_ilc_iw05_eu <- dt_ilc_iw05_eu %>%
  mutate(contract_type = case_when(
    .$wstatus == 'SAL_PERM' ~ 'Employees with a permanent job',
    TRUE ~ 'Employees with a temporary job'))

dt_ilc_iw05_eu <- dt_ilc_iw05_eu %>% select(contract_type, year, values)

ggplotly(
  ggplot(dt_ilc_iw05_eu, aes(year, values, color=contract_type)) +
    ggtitle('Europe - Men at risk of poverty rate by contract type') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Material and social deprivation rate by age, sex and most frequent activity status

```{r Material and social deprivation rate by age, sex and most frequent activity status for women,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_mdsd01 <- get_eurostat("ilc_mdsd01", stringsAsFactors = FALSE)

dt_ilc_mdsd01_it <- dt_ilc_mdsd01 %>% filter(geo == 'IT')

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% filter(wstatus == 'UNE') 

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% filter(sex == 'F') 

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% mutate(year = year(time))

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% select(age, year, values)

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mdsd01_it[[4]][dt_ilc_mdsd01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% select(age_description, year, values)

colnames(dt_ilc_mdsd01_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mdsd01_it, aes(year, values, color=age)) +
    ggtitle('Italy - Material and social deprivation rate for unemployed women by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mdsd01_it <- dt_ilc_mdsd01 %>% filter(geo == 'IT')

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% filter(wstatus == 'UNE') 

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% filter(sex == 'M') 

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% mutate(year = year(time))

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% select(age, year, values)

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mdsd01_it[[4]][dt_ilc_mdsd01_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mdsd01_it <- dt_ilc_mdsd01_it %>% select(age_description, year, values)

colnames(dt_ilc_mdsd01_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mdsd01_it, aes(year, values, color=age)) +
    ggtitle('Italy - Material and social deprivation rate for unemployed men by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_mdsd01_eu <- dt_ilc_mdsd01 %>% filter(geo == 'EU')

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% filter(wstatus == 'UNE') 

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% filter(sex == 'F') 

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% mutate(year = year(time))

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% select(age, year, values)

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mdsd01_eu[[4]][dt_ilc_mdsd01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% select(age_description, year, values)

colnames(dt_ilc_mdsd01_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mdsd01_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Material and social deprivation rate for unemployed women by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01 %>% filter(geo == 'EU')

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% filter(wstatus == 'UNE') 

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% filter(sex == 'M') 

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% mutate(year = year(time))

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% select(age, year, values)

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mdsd01_eu[[4]][dt_ilc_mdsd01_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mdsd01_eu <- dt_ilc_mdsd01_eu %>% select(age_description, year, values)

colnames(dt_ilc_mdsd01_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mdsd01_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Material and social deprivation rate for unemployed men by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Severe material deprivation rate by age and sex

```{r Severe material deprivation rate for women,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_mddd11 <- get_eurostat("ilc_mddd11", stringsAsFactors = FALSE)

dt_ilc_mddd11_it <- dt_ilc_mddd11 %>% filter(geo == 'IT')

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% filter(unit == 'PC')

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% filter(age != 'TOTAL') 

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% filter(sex == 'F') 

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% mutate(year = year(time))

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% select(age, year, values)

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mddd11_it[[4]][dt_ilc_mddd11_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% select(age_description, year, values)

colnames(dt_ilc_mddd11_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mddd11_it, aes(year, values, color=age)) +
    ggtitle('Italy - Severe material deprivation rate for women by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mddd11_it <- dt_ilc_mddd11 %>% filter(geo == 'IT')

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% filter(unit == 'PC')

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% filter(age != 'TOTAL') 

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% filter(sex == 'M') 

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% mutate(year = year(time))

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% select(age, year, values)

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mddd11_it[[4]][dt_ilc_mddd11_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mddd11_it <- dt_ilc_mddd11_it %>% select(age_description, year, values)

colnames(dt_ilc_mddd11_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mddd11_it, aes(year, values, color=age)) +
    ggtitle('Italy - Severe material deprivation rate for men by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_mddd11_eu <- dt_ilc_mddd11 %>% filter(geo == 'EU')

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% filter(unit == 'PC')

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% filter(age != 'TOTAL') 

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% filter(sex == 'F') 

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% mutate(year = year(time))

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% select(age, year, values)

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mddd11_eu[[4]][dt_ilc_mddd11_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% select(age_description, year, values)

colnames(dt_ilc_mddd11_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mddd11_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Severe material deprivation rate for women by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mddd11_eu <- dt_ilc_mddd11 %>% filter(geo == 'EU')

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% filter(unit == 'PC')

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% filter(age != 'TOTAL') 

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% filter(sex == 'M') 

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% mutate(year = year(time))

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% select(age, year, values)

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mddd11_eu[[4]][dt_ilc_mddd11_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mddd11_eu <- dt_ilc_mddd11_eu %>% select(age_description, year, values)

colnames(dt_ilc_mddd11_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mddd11_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Severe material deprivation rate for men by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Inability to keep home adequately warm

```{r Inability to keep home adequately warm - EU-SILC survey,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_mdes01 <- get_eurostat("ilc_mdes01", stringsAsFactors = FALSE)

dt_ilc_mdes01_it <- dt_ilc_mdes01 %>% filter(geo == 'IT')

dt_ilc_mdes01_it <- dt_ilc_mdes01_it %>% filter(incgrp == 'TOTAL')

dt_ilc_mdes01_it <- dt_ilc_mdes01_it %>% mutate(year = year(time))

dt_ilc_mdes01_it <- dt_ilc_mdes01_it %>% select(hhtyp, year, values)

dt_ilc_mdes01_it <- dt_ilc_mdes01_it %>% filter(hhtyp != 'TOTAL')

dt_ilc_mdes01_it <- dt_ilc_mdes01_it %>%
  mutate(household_composition = case_when(
    .$hhtyp == 'A1' ~ 'Single person',
    .$hhtyp == 'A1_LT65' ~ 'One adult younger than 65 years',
    .$hhtyp == 'A1_GE65' ~ 'One adult 65 years or over',
    .$hhtyp == 'A1_DCH' ~ 'Single person with dependent children',
    .$hhtyp == 'A1F' ~ 'Single female',
    .$hhtyp == 'A1M' ~ 'Single male',
    .$hhtyp == 'A2' ~ 'Two adults',
    .$hhtyp == 'A2_2LT65' ~ 'Two adults younger than 65 years',
    .$hhtyp == 'A2_GE1_GE65' ~ 'Two adults, at least one aged 65 years or over',
    .$hhtyp == 'A2_1DCH' ~ 'Two adults with one dependent child',
    .$hhtyp == 'A2_2DCH' ~ 'Two adults with two dependent children',
    .$hhtyp == 'A2_GE3DCH' ~ 'Two adults with three or more dependent children',
    .$hhtyp == 'A_GE2_NDCH' ~ 'Two or more adults without dependent children',
    .$hhtyp == 'A_GE2_DCH' ~ 'Two or more adults with dependent children',
    .$hhtyp == 'A_GE3' ~ 'Three or more adults',
    .$hhtyp == 'A_GE3_DCH' ~ 'Three or more adults with dependent children',
    .$hhtyp == 'HH_NDCH' ~ 'Households without dependent children',
    TRUE ~ 'Households with dependent children'))

dt_ilc_mdes01_it <- dt_ilc_mdes01_it %>% select(household_composition, year, values)

ggplotly(
  ggplot(dt_ilc_mdes01_it, aes(year, values, color=household_composition)) +
    ggtitle('Italy - Inability to keep home adequately warm by household composition') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mdes01_eu <- dt_ilc_mdes01 %>% filter(geo == 'EU')

dt_ilc_mdes01_eu <- dt_ilc_mdes01_eu %>% filter(incgrp == 'TOTAL')

dt_ilc_mdes01_eu <- dt_ilc_mdes01_eu %>% mutate(year = year(time))

dt_ilc_mdes01_eu <- dt_ilc_mdes01_eu %>% select(hhtyp, year, values)

dt_ilc_mdes01_eu <- dt_ilc_mdes01_eu %>% filter(hhtyp != 'TOTAL')

dt_ilc_mdes01_eu <- dt_ilc_mdes01_eu %>%
  mutate(household_composition = case_when(
    .$hhtyp == 'A1' ~ 'Single person',
    .$hhtyp == 'A1_LT65' ~ 'One adult younger than 65 years',
    .$hhtyp == 'A1_GE65' ~ 'One adult 65 years or over',
    .$hhtyp == 'A1_DCH' ~ 'Single person with dependent children',
    .$hhtyp == 'A1F' ~ 'Single female',
    .$hhtyp == 'A1M' ~ 'Single male',
    .$hhtyp == 'A2' ~ 'Two adults',
    .$hhtyp == 'A2_2LT65' ~ 'Two adults younger than 65 years',
    .$hhtyp == 'A2_GE1_GE65' ~ 'Two adults, at least one aged 65 years or over',
    .$hhtyp == 'A2_1DCH' ~ 'Two adults with one dependent child',
    .$hhtyp == 'A2_2DCH' ~ 'Two adults with two dependent children',
    .$hhtyp == 'A2_GE3DCH' ~ 'Two adults with three or more dependent children',
    .$hhtyp == 'A_GE2_NDCH' ~ 'Two or more adults without dependent children',
    .$hhtyp == 'A_GE2_DCH' ~ 'Two or more adults with dependent children',
    .$hhtyp == 'A_GE3' ~ 'Three or more adults',
    .$hhtyp == 'A_GE3_DCH' ~ 'Three or more adults with dependent children',
    .$hhtyp == 'HH_NDCH' ~ 'Households without dependent children',
    TRUE ~ 'Households with dependent children'))

dt_ilc_mdes01_eu <- dt_ilc_mdes01_eu %>% select(household_composition, year, values)

ggplotly(
  ggplot(dt_ilc_mdes01_eu, aes(year, values, color=household_composition)) +
    ggtitle('Europe - Inability to keep home adequately warm by household composition') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Inability to afford a meal with meat, chicken, fish (or vegetarian equivalent) every second day

```{r Inability to afford a meal with meat, chicken, fish (or vegetarian equivalent) every second day - EU-SILC survey,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_mdes03 <- get_eurostat("ilc_mdes03", stringsAsFactors = FALSE)

dt_ilc_mdes03_it <- dt_ilc_mdes03 %>% filter(geo == 'IT')

dt_ilc_mdes03_it <- dt_ilc_mdes03_it %>% filter(incgrp == 'TOTAL')

dt_ilc_mdes03_it <- dt_ilc_mdes03_it %>% mutate(year = year(time))

dt_ilc_mdes03_it <- dt_ilc_mdes03_it %>% select(hhtyp, year, values)

dt_ilc_mdes03_it <- dt_ilc_mdes03_it %>% filter(hhtyp != 'TOTAL')

dt_ilc_mdes03_it <- dt_ilc_mdes03_it %>%
  mutate(household_composition = case_when(
    .$hhtyp == 'A1' ~ 'Single person',
    .$hhtyp == 'A1_LT65' ~ 'One adult younger than 65 years',
    .$hhtyp == 'A1_GE65' ~ 'One adult 65 years or over',
    .$hhtyp == 'A1_DCH' ~ 'Single person with dependent children',
    .$hhtyp == 'A1F' ~ 'Single female',
    .$hhtyp == 'A1M' ~ 'Single male',
    .$hhtyp == 'A2' ~ 'Two adults',
    .$hhtyp == 'A2_2LT65' ~ 'Two adults younger than 65 years',
    .$hhtyp == 'A2_GE1_GE65' ~ 'Two adults, at least one aged 65 years or over',
    .$hhtyp == 'A2_1DCH' ~ 'Two adults with one dependent child',
    .$hhtyp == 'A2_2DCH' ~ 'Two adults with two dependent children',
    .$hhtyp == 'A2_GE3DCH' ~ 'Two adults with three or more dependent children',
    .$hhtyp == 'A_GE2_NDCH' ~ 'Two or more adults without dependent children',
    .$hhtyp == 'A_GE2_DCH' ~ 'Two or more adults with dependent children',
    .$hhtyp == 'A_GE3' ~ 'Three or more adults',
    .$hhtyp == 'A_GE3_DCH' ~ 'Three or more adults with dependent children',
    .$hhtyp == 'HH_NDCH' ~ 'Households without dependent children',
    TRUE ~ 'Households with dependent children'))

dt_ilc_mdes03_it <- dt_ilc_mdes03_it %>% select(household_composition, year, values)

ggplotly(
  ggplot(dt_ilc_mdes03_it, aes(year, values, color=household_composition)) +
    ggtitle('Italy - Inability to afford a meal with meat, chicken, fish every second day by household composition') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mdes03_eu <- dt_ilc_mdes03 %>% filter(geo == 'EU')

dt_ilc_mdes03_eu <- dt_ilc_mdes03_eu %>% filter(incgrp == 'TOTAL')

dt_ilc_mdes03_eu <- dt_ilc_mdes03_eu %>% mutate(year = year(time))

dt_ilc_mdes03_eu <- dt_ilc_mdes03_eu %>% select(hhtyp, year, values)

dt_ilc_mdes03_eu <- dt_ilc_mdes03_eu %>% filter(hhtyp != 'TOTAL')

dt_ilc_mdes03_eu <- dt_ilc_mdes03_eu %>%
  mutate(household_composition = case_when(
    .$hhtyp == 'A1' ~ 'Single person',
    .$hhtyp == 'A1_LT65' ~ 'One adult younger than 65 years',
    .$hhtyp == 'A1_GE65' ~ 'One adult 65 years or over',
    .$hhtyp == 'A1_DCH' ~ 'Single person with dependent children',
    .$hhtyp == 'A1F' ~ 'Single female',
    .$hhtyp == 'A1M' ~ 'Single male',
    .$hhtyp == 'A2' ~ 'Two adults',
    .$hhtyp == 'A2_2LT65' ~ 'Two adults younger than 65 years',
    .$hhtyp == 'A2_GE1_GE65' ~ 'Two adults, at least one aged 65 years or over',
    .$hhtyp == 'A2_1DCH' ~ 'Two adults with one dependent child',
    .$hhtyp == 'A2_2DCH' ~ 'Two adults with two dependent children',
    .$hhtyp == 'A2_GE3DCH' ~ 'Two adults with three or more dependent children',
    .$hhtyp == 'A_GE2_NDCH' ~ 'Two or more adults without dependent children',
    .$hhtyp == 'A_GE2_DCH' ~ 'Two or more adults with dependent children',
    .$hhtyp == 'A_GE3' ~ 'Three or more adults',
    .$hhtyp == 'A_GE3_DCH' ~ 'Three or more adults with dependent children',
    .$hhtyp == 'HH_NDCH' ~ 'Households without dependent children',
    TRUE ~ 'Households with dependent children'))

dt_ilc_mdes03_eu <- dt_ilc_mdes03_eu %>% select(household_composition, year, values)

ggplotly(
  ggplot(dt_ilc_mdes03_eu, aes(year, values, color=household_composition)) +
    ggtitle('Europe - Inability to afford a meal with meat, chicken, fish every second day by household composition') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Persons who cannot afford a computer

```{r Persons who cannot afford a computer - EU-SILC survey,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_mddu03 <- get_eurostat("ilc_mddu03", stringsAsFactors = FALSE)

dt_ilc_mddu03_it <- dt_ilc_mddu03 %>% filter(geo == 'IT')

dt_ilc_mddu03_it <- dt_ilc_mddu03_it %>% filter(incgrp == 'TOTAL')

dt_ilc_mddu03_it <- dt_ilc_mddu03_it %>% mutate(year = year(time))

dt_ilc_mddu03_it <- dt_ilc_mddu03_it %>% 
  filter(hhtyp %in% c('A2_1DCH', 'A2_2DCH', 'A2_GE3DCH', 'A_GE3_DCH', 'HH_DCH'))

dt_ilc_mddu03_it <- dt_ilc_mddu03_it %>% select(hhtyp, year, values)

dt_ilc_mddu03_it <- dt_ilc_mddu03_it %>%
  mutate(household_composition = case_when(
    .$hhtyp == 'A1' ~ 'Single person',
    .$hhtyp == 'A1_LT65' ~ 'One adult younger than 65 years',
    .$hhtyp == 'A1_GE65' ~ 'One adult 65 years or over',
    .$hhtyp == 'A1_DCH' ~ 'Single person with dependent children',
    .$hhtyp == 'A1F' ~ 'Single female',
    .$hhtyp == 'A1M' ~ 'Single male',
    .$hhtyp == 'A2' ~ 'Two adults',
    .$hhtyp == 'A2_2LT65' ~ 'Two adults younger than 65 years',
    .$hhtyp == 'A2_GE1_GE65' ~ 'Two adults, at least one aged 65 years or over',
    .$hhtyp == 'A2_1DCH' ~ 'Two adults with one dependent child',
    .$hhtyp == 'A2_2DCH' ~ 'Two adults with two dependent children',
    .$hhtyp == 'A2_GE3DCH' ~ 'Two adults with three or more dependent children',
    .$hhtyp == 'A_GE2_NDCH' ~ 'Two or more adults without dependent children',
    .$hhtyp == 'A_GE2_DCH' ~ 'Two or more adults with dependent children',
    .$hhtyp == 'A_GE3' ~ 'Three or more adults',
    .$hhtyp == 'A_GE3_DCH' ~ 'Three or more adults with dependent children',
    .$hhtyp == 'HH_NDCH' ~ 'Households without dependent children',
    TRUE ~ 'Households with dependent children'))

dt_ilc_mddu03_it <- dt_ilc_mddu03_it %>% select(household_composition, year, values)

ggplotly(
  ggplot(dt_ilc_mddu03_it, aes(year, values, color=household_composition)) +
    ggtitle('Italy - Persons who cannot afford a computer by household composition') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mddu03_eu <- dt_ilc_mddu03 %>% filter(geo == 'EU')

dt_ilc_mddu03_eu <- dt_ilc_mddu03_eu %>% filter(incgrp == 'TOTAL')

dt_ilc_mddu03_eu <- dt_ilc_mddu03_eu %>% mutate(year = year(time))

dt_ilc_mddu03_eu <- dt_ilc_mddu03_eu %>% 
  filter(hhtyp %in% c('A2_1DCH', 'A2_2DCH', 'A2_GE3DCH', 'A_GE3_DCH', 'HH_DCH'))

dt_ilc_mddu03_eu <- dt_ilc_mddu03_eu %>% select(hhtyp, year, values)

dt_ilc_mddu03_eu <- dt_ilc_mddu03_eu %>%
  mutate(household_composition = case_when(
    .$hhtyp == 'A1' ~ 'Single person',
    .$hhtyp == 'A1_LT65' ~ 'One adult younger than 65 years',
    .$hhtyp == 'A1_GE65' ~ 'One adult 65 years or over',
    .$hhtyp == 'A1_DCH' ~ 'Single person with dependent children',
    .$hhtyp == 'A1F' ~ 'Single female',
    .$hhtyp == 'A1M' ~ 'Single male',
    .$hhtyp == 'A2' ~ 'Two adults',
    .$hhtyp == 'A2_2LT65' ~ 'Two adults younger than 65 years',
    .$hhtyp == 'A2_GE1_GE65' ~ 'Two adults, at least one aged 65 years or over',
    .$hhtyp == 'A2_1DCH' ~ 'Two adults with one dependent child',
    .$hhtyp == 'A2_2DCH' ~ 'Two adults with two dependent children',
    .$hhtyp == 'A2_GE3DCH' ~ 'Two adults with three or more dependent children',
    .$hhtyp == 'A_GE2_NDCH' ~ 'Two or more adults without dependent children',
    .$hhtyp == 'A_GE2_DCH' ~ 'Two or more adults with dependent children',
    .$hhtyp == 'A_GE3' ~ 'Three or more adults',
    .$hhtyp == 'A_GE3_DCH' ~ 'Three or more adults with dependent children',
    .$hhtyp == 'HH_NDCH' ~ 'Households without dependent children',
    TRUE ~ 'Households with dependent children'))

dt_ilc_mddu03_eu <- dt_ilc_mddu03_eu %>% select(household_composition, year, values)

ggplotly(
  ggplot(dt_ilc_mddu03_eu, aes(year, values, color=household_composition)) +
    ggtitle('Europe - Persons who cannot afford a computer by household composition') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```

### Persons who cannot afford internet connection for personal use at home by age, sex and income group

```{r Persons who cannot afford internet connection for personal use at home by age, sex and income group,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_mddu07a <- get_eurostat("ilc_mddu07a", stringsAsFactors = FALSE)

dt_ilc_mddu07a_it <- dt_ilc_mddu07a %>% filter(geo == 'IT')

dt_ilc_mddu07a_it <- dt_ilc_mddu07a_it %>% filter(incgrp == 'TOTAL')

dt_ilc_mddu07a_it <- dt_ilc_mddu07a_it %>% filter(age == 'Y16-29')

dt_ilc_mddu07a_it <- dt_ilc_mddu07a_it %>% filter(sex != 'T')

dt_ilc_mddu07a_it <- dt_ilc_mddu07a_it %>% mutate(year = year(time))

dt_ilc_mddu07a_it <- dt_ilc_mddu07a_it %>% select(sex, year, values)

ggplotly(
  ggplot(dt_ilc_mddu07a_it, aes(year, values, color=sex)) +
    ggtitle('Italy - Persons between 16 and 19 who cannot afford internet connection for personal use at home, by sex') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mddu07a_it <- dt_ilc_mddu07a %>% filter(geo == 'IT')

dt_ilc_mddu07a_it <- dt_ilc_mddu07a_it %>% filter(incgrp == 'B_MD60')

dt_ilc_mddu07a_it <- dt_ilc_mddu07a_it %>% filter(age == 'Y16-29')

dt_ilc_mddu07a_it <- dt_ilc_mddu07a_it %>% filter(sex != 'T')

dt_ilc_mddu07a_it <- dt_ilc_mddu07a_it %>% mutate(year = year(time))

dt_ilc_mddu07a_it <- dt_ilc_mddu07a_it %>% select(sex, year, values)

ggplotly(
  ggplot(dt_ilc_mddu07a_it, aes(year, values, color=sex)) +
    ggtitle('Italy - Persons, below 60% of median equivalised income, between 16 and 19 who cannot afford internet connection for personal use at home, by sex') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a %>% filter(geo == 'EU')

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a_eu %>% filter(incgrp == 'TOTAL')

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a_eu %>% filter(age == 'Y16-29')

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a_eu %>% filter(sex != 'T')

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a_eu %>% mutate(year = year(time))

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a_eu %>% select(sex, year, values)

ggplotly(
  ggplot(dt_ilc_mddu07a_it, aes(year, values, color=sex)) +
    ggtitle('Europe - Persons between 16 and 19 who cannot afford internet connection for personal use at home, by sex') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a %>% filter(geo == 'EU')

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a_eu %>% filter(incgrp == 'B_MD60')

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a_eu %>% filter(age == 'Y16-29')

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a_eu %>% filter(sex != 'T')

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a_eu %>% mutate(year = year(time))

dt_ilc_mddu07a_eu <- dt_ilc_mddu07a_eu %>% select(sex, year, values)

ggplotly(
  ggplot(dt_ilc_mddu07a_it, aes(year, values, color=sex)) +
    ggtitle('Europe - Persons, below 60% of median equivalised income, between 16 and 19 who cannot afford internet connection for personal use at home, by sex') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Severe housing deprivation rate by age, sex and poverty status

```{r Severe housing deprivation rate by age, sex and poverty status - EU-SILC survey,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_ilc_mdho06a <- get_eurostat("ilc_mdho06a", stringsAsFactors = FALSE)

dt_ilc_mdho06a_it <- dt_ilc_mdho06a %>% filter(geo == 'IT')

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% filter(incgrp == 'TOTAL')

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% filter(age == 'TOTAL')

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% filter(sex != 'T')

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% mutate(year = year(time))

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% select(sex, year, values)

ggplotly(
  ggplot(dt_ilc_mdho06a_it, aes(year, values, color=sex)) +
    ggtitle('Italy - Severe housing deprivation rate by sex') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mdho06a_it <- dt_ilc_mdho06a %>% filter(geo == 'IT')

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% filter(incgrp == 'TOTAL')

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% filter(sex == 'M')

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% mutate(year = year(time))

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% select(age, year, values)

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mdho06a_it[[4]][dt_ilc_mdho06a_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% select(age_description, year, values)

colnames(dt_ilc_mdho06a_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mdho06a_it, aes(year, values, color=age)) +
    ggtitle('Italy - Men with severe housing deprivation rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)


dt_ilc_mdho06a_it <- dt_ilc_mdho06a %>% filter(geo == 'IT')

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% filter(incgrp == 'TOTAL')

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% filter(sex == 'F')

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% mutate(year = year(time))

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% select(age, year, values)

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mdho06a_it[[4]][dt_ilc_mdho06a_it[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mdho06a_it <- dt_ilc_mdho06a_it %>% select(age_description, year, values)

colnames(dt_ilc_mdho06a_it) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mdho06a_it, aes(year, values, color=age)) +
    ggtitle('Italy - Women with severe housing deprivation rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a %>% filter(geo == 'EU')

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% filter(incgrp == 'TOTAL')

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% filter(age == 'TOTAL')

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% filter(sex != 'T')

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% mutate(year = year(time))

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% select(sex, year, values)

ggplotly(
  ggplot(dt_ilc_mdho06a_eu, aes(year, values, color=sex)) +
    ggtitle('Europe - Severe housing deprivation rate by sex') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a %>% filter(geo == 'EU')

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% filter(incgrp == 'TOTAL')

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% filter(sex == 'M')

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% mutate(year = year(time))

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% select(age, year, values)

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mdho06a_eu[[4]][dt_ilc_mdho06a_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% select(age_description, year, values)

colnames(dt_ilc_mdho06a_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mdho06a_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Men with severe housing deprivation rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)



dt_ilc_mdho06a_eu <- dt_ilc_mdho06a %>% filter(geo == 'EU')

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% filter(incgrp == 'TOTAL')

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% filter(sex == 'F')

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% mutate(year = year(time))

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% select(age, year, values)

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% mutate(age_description = age)

for (age_value in age){
  dt_ilc_mdho06a_eu[[4]][dt_ilc_mdho06a_eu[[1]] == age_value] <- getAgeDescription(age_value)$age_description
}

dt_ilc_mdho06a_eu <- dt_ilc_mdho06a_eu %>% select(age_description, year, values)

colnames(dt_ilc_mdho06a_eu) <- c('age', 'year', 'values')

ggplotly(
  ggplot(dt_ilc_mdho06a_eu, aes(year, values, color=age)) +
    ggtitle('Europe - Women with severe housing deprivation rate by age') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### House price index

```{r HOUSE PRICE INDEX,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_prc_hpi_a <- get_eurostat("prc_hpi_a", stringsAsFactors = FALSE)

dt_prc_hpi_a_it <- dt_prc_hpi_a %>% filter(geo == 'IT')

dt_prc_hpi_a_it <- dt_prc_hpi_a_it %>% filter(unit == 'RCH_A_AVG')

dt_prc_hpi_a_it <- dt_prc_hpi_a_it %>% mutate(year = year(time))

dt_prc_hpi_a_it <- dt_prc_hpi_a_it %>% select(purchase, year, values)

dt_prc_hpi_a_it <- dt_prc_hpi_a_it %>% filter(purchase != 'TOTAL')

dt_prc_hpi_a_it <- dt_prc_hpi_a_it %>%
  mutate(purchase_type = case_when(
    .$purchase == 'DW_NEW' ~ 'Purchases of new dwellings',
    TRUE ~ 'Purchases of existing dwellings'))

dt_prc_hpi_a_it <- dt_prc_hpi_a_it %>% select(purchase_type, year, values)

ggplotly(
  ggplot(dt_prc_hpi_a_it, aes(year, values, color=purchase_type)) +
    ggtitle('Italy - House price index') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_prc_hpi_a_eu <- dt_prc_hpi_a %>% filter(geo == 'EU')

dt_prc_hpi_a_eu <- dt_prc_hpi_a_eu %>% filter(unit == 'RCH_A_AVG')

dt_prc_hpi_a_eu <- dt_prc_hpi_a_eu %>% mutate(year = year(time))

dt_prc_hpi_a_eu <- dt_prc_hpi_a_eu %>% select(purchase, year, values)

dt_prc_hpi_a_eu <- dt_prc_hpi_a_eu %>%
  mutate(purchase_type = case_when(
    .$purchase == 'DW_NEW' ~ 'Purchases of new dwellings',
    .$purchase == 'TOTAL' ~ 'Total',
    TRUE ~ 'Purchases of existing dwellings'))

dt_prc_hpi_a_eu <- dt_prc_hpi_a_eu %>% select(purchase_type, year, values)

ggplotly(
  ggplot(dt_prc_hpi_a_eu, aes(year, values, color=purchase_type)) +
    ggtitle('Europe - House price index') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Consumer price index (HICP - annual data (average index and rate of change))

```{r HICP - annual data (average index and rate of change),echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_prc_hicp_aind <- get_eurostat("prc_hicp_aind", stringsAsFactors = FALSE)

dt_prc_hicp_aind_it <- dt_prc_hicp_aind %>% filter(geo == 'IT')

dt_prc_hicp_aind_it <- dt_prc_hicp_aind_it %>% filter(unit == 'RCH_A_AVG')

dt_prc_hicp_aind_it <- dt_prc_hicp_aind_it %>% 
  filter(coicop %in% c('CP01', 'CP02', 'CP03', 'CP04', 'CP05', 'CP06',
                       'CP07', 'CP08', 'CP09', 'CP10', 'CP11', 'CP12'))

dt_prc_hicp_aind_it <- dt_prc_hicp_aind_it %>% mutate(year = year(time))

dt_prc_hicp_aind_it <- dt_prc_hicp_aind_it %>% select(coicop, year, values)

dt_prc_hicp_aind_it <- dt_prc_hicp_aind_it %>%
  mutate(type = case_when(
    .$coicop == 'CP01' ~ 'Food and non-alcoholic beverages',
    .$coicop == 'CP02' ~ 'Alcoholic beverages, tobacco and narcotics',
    .$coicop == 'CP03' ~ 'Clothing and footwear',
    .$coicop == 'CP04' ~ 'Housing, water, electricity, gas and other fuels',
    .$coicop == 'CP05' ~ 'Furnishings, household equipment and routine household maintenance',
    .$coicop == 'CP06' ~ 'Health',
    .$coicop == 'CP07' ~ 'Transport',
    .$coicop == 'CP08' ~ 'Communications',
    .$coicop == 'CP09' ~ 'Recreation and culture',
    .$coicop == 'CP10' ~ 'Education',
    .$coicop == 'CP11' ~ 'Restaurants and hotels',
    TRUE ~ 'Miscellaneous goods and services'))

dt_prc_hicp_aind_it <- dt_prc_hicp_aind_it %>% select(type, year, values)

ggplotly(
  ggplot(dt_prc_hicp_aind_it, aes(year, values, color=type)) +
    ggtitle('Italy - Consumer price index (Annual average rate of change)') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_prc_hicp_aind_eu <- dt_prc_hicp_aind %>% filter(geo == 'EU')

dt_prc_hicp_aind_eu <- dt_prc_hicp_aind_eu %>% filter(unit == 'RCH_A_AVG')

dt_prc_hicp_aind_eu <- dt_prc_hicp_aind_eu %>% 
  filter(coicop %in% c('CP01', 'CP02', 'CP03', 'CP04', 'CP05', 'CP06',
                       'CP07', 'CP08', 'CP09', 'CP10', 'CP11', 'CP12'))

dt_prc_hicp_aind_eu <- dt_prc_hicp_aind_eu %>% mutate(year = year(time))

dt_prc_hicp_aind_eu <- dt_prc_hicp_aind_eu %>% select(coicop, year, values)

dt_prc_hicp_aind_eu <- dt_prc_hicp_aind_eu %>%
  mutate(type = case_when(
    .$coicop == 'CP01' ~ 'Food and non-alcoholic beverages',
    .$coicop == 'CP02' ~ 'Alcoholic beverages, tobacco and narcotics',
    .$coicop == 'CP03' ~ 'Clothing and footwear',
    .$coicop == 'CP04' ~ 'Housing, water, electricity, gas and other fuels',
    .$coicop == 'CP05' ~ 'Furnishings, household equipment and routine household maintenance',
    .$coicop == 'CP06' ~ 'Health',
    .$coicop == 'CP07' ~ 'Transport',
    .$coicop == 'CP08' ~ 'Communications',
    .$coicop == 'CP09' ~ 'Recreation and culture',
    .$coicop == 'CP10' ~ 'Education',
    .$coicop == 'CP11' ~ 'Restaurants and hotels',
    TRUE ~ 'Miscellaneous goods and services'))

dt_prc_hicp_aind_eu <- dt_prc_hicp_aind_eu %>% select(type, year, values)

ggplotly(
  ggplot(dt_prc_hicp_aind_eu, aes(year, values, color=type)) +
    ggtitle('Europe - Consumer price index (Annual average rate of change)') +
    geom_line() +
    labs(x="Year", y="Percentage") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

```


### Social protection (Expenditure)

```{r Expenditure: main results Percentage of gross domestic product,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_spr_exp_sum <- get_eurostat("spr_exp_sum", stringsAsFactors = FALSE)

dt_spr_exp_sum_it <- dt_spr_exp_sum %>% filter(geo == 'IT')

dt_PC_GDP <- dt_spr_exp_sum_it %>% filter(unit == 'PC_GDP')

dt_PC_GDP <- dt_PC_GDP %>% mutate(year = year(time))

dt_PC_GDP <- dt_PC_GDP %>% select(spdeps, year, values)

dt_PC_GDP <- dt_PC_GDP %>%
  mutate(expenses = case_when(
    .$spdeps == 'TOTALNOREROUTE' ~ 'Total expenditure',
    .$spdeps == 'SPBENEFNOREROUTE' ~ 'Social protection benefits',
    .$spdeps == 'ADMIN' ~ 'Administration costs',
    .$spdeps == 'OTHER' ~ 'Other expenditure',
    .$spdeps == 'SICK' ~ 'Sickness/Health care',
    .$spdeps == 'DISA' ~ 'Disability',
    .$spdeps == 'OLD' ~ 'Old age',
    .$spdeps == 'SURVIV' ~ 'Survivors',
    .$spdeps == 'FAM' ~ 'Family/Children',
    .$spdeps == 'UNEMPLOY' ~ 'Unemployment',
    .$spdeps == 'HOUSE' ~ 'Housing',
    .$spdeps == 'EXCLU' ~ 'Social exclusion n.e.c.',
    .$spdeps == 'SICKDISA' ~ 'Sickness/healthcare and disability',
    .$spdeps == 'OLDSURVIV' ~ 'Old age and survivors',
    TRUE ~ 'Miscellaneous goods and services'))

dt_PC_GDP <- dt_PC_GDP %>% select(expenses, year, values)

ggplotly(
  ggplot(dt_PC_GDP, aes(year, values, color=expenses)) +
    ggtitle('Italy - Social protection (Expenditure)') +
    geom_line() +
    labs(x="Year", y="Percentage of gross domestic product") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_spr_exp_sum_eu <- dt_spr_exp_sum %>% filter(geo == 'EU28')
dt_PC_GDP <- dt_spr_exp_sum_eu %>% filter(unit == 'PC_GDP')

dt_PC_GDP <- dt_PC_GDP %>% mutate(year = year(time))

dt_PC_GDP <- dt_PC_GDP %>% select(spdeps, year, values)

dt_PC_GDP <- dt_PC_GDP %>%
  mutate(expenses = case_when(
    .$spdeps == 'TOTALNOREROUTE' ~ 'Total expenditure',
    .$spdeps == 'SPBENEFNOREROUTE' ~ 'Social protection benefits',
    .$spdeps == 'ADMIN' ~ 'Administration costs',
    .$spdeps == 'OTHER' ~ 'Other expenditure',
    .$spdeps == 'SICK' ~ 'Sickness/Health care',
    .$spdeps == 'DISA' ~ 'Disability',
    .$spdeps == 'OLD' ~ 'Old age',
    .$spdeps == 'SURVIV' ~ 'Survivors',
    .$spdeps == 'FAM' ~ 'Family/Children',
    .$spdeps == 'UNEMPLOY' ~ 'Unemployment',
    .$spdeps == 'HOUSE' ~ 'Housing',
    .$spdeps == 'EXCLU' ~ 'Social exclusion n.e.c.',
    .$spdeps == 'SICKDISA' ~ 'Sickness/healthcare and disability',
    .$spdeps == 'OLDSURVIV' ~ 'Old age and survivors',
    TRUE ~ 'Miscellaneous goods and services'))

dt_PC_GDP <- dt_PC_GDP %>% select(expenses, year, values)

ggplotly(
  ggplot(dt_PC_GDP, aes(year, values, color=expenses)) +
    ggtitle('Europe - Social protection (Expenditure)') +
    geom_line() +
    labs(x="Year", y="Percentage of gross domestic product") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```



```{r Expenditure: main results Percentage of total benefits,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_PC_BEN <- dt_spr_exp_sum_it %>% filter(unit == 'PC_BEN')

dt_PC_BEN <- dt_PC_BEN %>% mutate(year = year(time))

dt_PC_BEN <- dt_PC_BEN %>% select(spdeps, year, values)

dt_PC_BEN <- dt_PC_BEN %>%
  mutate(expenses = case_when(
    .$spdeps == 'TOTALNOREROUTE' ~ 'Total expenditure',
    .$spdeps == 'SPBENEFNOREROUTE' ~ 'Social protection benefits',
    .$spdeps == 'ADMIN' ~ 'Administration costs',
    .$spdeps == 'OTHER' ~ 'Other expenditure',
    .$spdeps == 'SICK' ~ 'Sickness/Health care',
    .$spdeps == 'DISA' ~ 'Disability',
    .$spdeps == 'OLD' ~ 'Old age',
    .$spdeps == 'SURVIV' ~ 'Survivors',
    .$spdeps == 'FAM' ~ 'Family/Children',
    .$spdeps == 'UNEMPLOY' ~ 'Unemployment',
    .$spdeps == 'HOUSE' ~ 'Housing',
    .$spdeps == 'EXCLU' ~ 'Social exclusion n.e.c.',
    .$spdeps == 'SICKDISA' ~ 'Sickness/healthcare and disability',
    .$spdeps == 'OLDSURVIV' ~ 'Old age and survivors',
    TRUE ~ 'Miscellaneous goods and services'))

dt_PC_BEN <- dt_PC_BEN %>% select(expenses, year, values)

ggplotly(
  ggplot(dt_PC_BEN, aes(year, values, color=expenses)) +
    ggtitle('Itay - Social protection (Expenditure)') +
    geom_line() +
    labs(x="Year", y="Percentage of total benefits") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_PC_BEN <- dt_spr_exp_sum_eu %>% filter(unit == 'PC_BEN')

dt_PC_BEN <- dt_PC_BEN %>% mutate(year = year(time))

dt_PC_BEN <- dt_PC_BEN %>% select(spdeps, year, values)

dt_PC_BEN <- dt_PC_BEN %>%
  mutate(expenses = case_when(
    .$spdeps == 'TOTALNOREROUTE' ~ 'Total expenditure',
    .$spdeps == 'SPBENEFNOREROUTE' ~ 'Social protection benefits',
    .$spdeps == 'ADMIN' ~ 'Administration costs',
    .$spdeps == 'OTHER' ~ 'Other expenditure',
    .$spdeps == 'SICK' ~ 'Sickness/Health care',
    .$spdeps == 'DISA' ~ 'Disability',
    .$spdeps == 'OLD' ~ 'Old age',
    .$spdeps == 'SURVIV' ~ 'Survivors',
    .$spdeps == 'FAM' ~ 'Family/Children',
    .$spdeps == 'UNEMPLOY' ~ 'Unemployment',
    .$spdeps == 'HOUSE' ~ 'Housing',
    .$spdeps == 'EXCLU' ~ 'Social exclusion n.e.c.',
    .$spdeps == 'SICKDISA' ~ 'Sickness/healthcare and disability',
    .$spdeps == 'OLDSURVIV' ~ 'Old age and survivors',
    TRUE ~ 'Miscellaneous goods and services'))

dt_PC_BEN <- dt_PC_BEN %>% select(expenses, year, values)

ggplotly(
  ggplot(dt_PC_BEN, aes(year, values, color=expenses)) +
    ggtitle('Europe - Social protection (Expenditure)') +
    geom_line() +
    labs(x="Year", y="Percentage of total benefits") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```



```{r Expenditure: main results Percentage of total expenditure,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_PC_BEN <- dt_spr_exp_sum_it %>% filter(unit == 'PC_EXP')

dt_PC_BEN <- dt_PC_BEN %>% mutate(year = year(time))

dt_PC_BEN <- dt_PC_BEN %>% select(spdeps, year, values)

dt_PC_BEN <- dt_PC_BEN %>%
  mutate(expenses = case_when(
    .$spdeps == 'TOTALNOREROUTE' ~ 'Total expenditure',
    .$spdeps == 'SPBENEFNOREROUTE' ~ 'Social protection benefits',
    .$spdeps == 'ADMIN' ~ 'Administration costs',
    .$spdeps == 'OTHER' ~ 'Other expenditure',
    .$spdeps == 'SICK' ~ 'Sickness/Health care',
    .$spdeps == 'DISA' ~ 'Disability',
    .$spdeps == 'OLD' ~ 'Old age',
    .$spdeps == 'SURVIV' ~ 'Survivors',
    .$spdeps == 'FAM' ~ 'Family/Children',
    .$spdeps == 'UNEMPLOY' ~ 'Unemployment',
    .$spdeps == 'HOUSE' ~ 'Housing',
    .$spdeps == 'EXCLU' ~ 'Social exclusion n.e.c.',
    .$spdeps == 'SICKDISA' ~ 'Sickness/healthcare and disability',
    .$spdeps == 'OLDSURVIV' ~ 'Old age and survivors',
    TRUE ~ 'Miscellaneous goods and services'))

dt_PC_BEN <- dt_PC_BEN %>% select(expenses, year, values)

ggplotly(
  ggplot(dt_PC_BEN, aes(year, values, color=expenses)) +
    ggtitle('Italy - Social protection (Expenditure)') +
    geom_line() +
    labs(x="Year", y="Percentage of total expenditure") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_PC_BEN <- dt_spr_exp_sum_eu %>% filter(unit == 'PC_EXP')

dt_PC_BEN <- dt_PC_BEN %>% mutate(year = year(time))

dt_PC_BEN <- dt_PC_BEN %>% select(spdeps, year, values)

dt_PC_BEN <- dt_PC_BEN %>%
  mutate(expenses = case_when(
    .$spdeps == 'TOTALNOREROUTE' ~ 'Total expenditure',
    .$spdeps == 'SPBENEFNOREROUTE' ~ 'Social protection benefits',
    .$spdeps == 'ADMIN' ~ 'Administration costs',
    .$spdeps == 'OTHER' ~ 'Other expenditure',
    .$spdeps == 'SICK' ~ 'Sickness/Health care',
    .$spdeps == 'DISA' ~ 'Disability',
    .$spdeps == 'OLD' ~ 'Old age',
    .$spdeps == 'SURVIV' ~ 'Survivors',
    .$spdeps == 'FAM' ~ 'Family/Children',
    .$spdeps == 'UNEMPLOY' ~ 'Unemployment',
    .$spdeps == 'HOUSE' ~ 'Housing',
    .$spdeps == 'EXCLU' ~ 'Social exclusion n.e.c.',
    .$spdeps == 'SICKDISA' ~ 'Sickness/healthcare and disability',
    .$spdeps == 'OLDSURVIV' ~ 'Old age and survivors',
    TRUE ~ 'Miscellaneous goods and services'))

dt_PC_BEN <- dt_PC_BEN %>% select(expenses, year, values)

ggplotly(
  ggplot(dt_PC_BEN, aes(year, values, color=expenses)) +
    ggtitle('Europe - Social protection (Expenditure)') +
    geom_line() +
    labs(x="Year", y="Percentage of total expenditure") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### Social protection (Pensions)

```{r Pensions,echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_spr_exp_pens <- get_eurostat("spr_exp_pens", stringsAsFactors = FALSE)

dt_spr_exp_pens_it <- dt_spr_exp_pens %>% filter(geo == 'IT')

dt_spr_exp_pens_it <- dt_spr_exp_pens_it %>% filter(spdepm == 'TOTAL')

dt_spr_exp_pens_it <- dt_spr_exp_pens_it %>% filter(unit == 'PC_GDP')

dt_spr_exp_pens_it <- dt_spr_exp_pens_it %>% mutate(year = year(time))

dt_spr_exp_pens_it <- dt_spr_exp_pens_it %>% select(spdepb, year, values)

dt_spr_exp_pens_it <- dt_spr_exp_pens_it %>% filter(spdepb != 'TOTAL')

dt_spr_exp_pens_it <- dt_spr_exp_pens_it %>%
  mutate(type = case_when(
    .$spdepb == 'SCPOLDPEN' ~ 'Old age pension',
    .$spdepb == 'SCPANTPEN' ~ 'Anticipated old age pension',
    .$spdepb == 'SCPPARPEN' ~ 'Partial pension',
    .$spdepb == 'SCPDISPEN' ~ 'Disability pension',
    .$spdepb == 'SCPEARLYRED' ~ 'Early retirement benefit due to reduced capacity to work',
    .$spdepb == 'SCPSURVPEN' ~ 'Survivors pension',
    TRUE ~ 'Early retirement benefit for labour market reasons'))

dt_spr_exp_pens_it <- dt_spr_exp_pens_it %>% select(type, year, values)

ggplotly(
  ggplot(dt_spr_exp_pens_it, aes(year, values, color=type)) +
    ggtitle('Italy - Pensions') +
    geom_line() +
    labs(x="Year", y="Percentage of gross domestic product") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_spr_exp_pens_eu <- dt_spr_exp_pens %>% filter(geo == 'EU28')

dt_spr_exp_pens_eu <- dt_spr_exp_pens_eu %>% filter(spdepm == 'TOTAL')

dt_spr_exp_pens_eu <- dt_spr_exp_pens_eu %>% filter(unit == 'PC_GDP')

dt_spr_exp_pens_eu <- dt_spr_exp_pens_eu %>% mutate(year = year(time))

dt_spr_exp_pens_eu <- dt_spr_exp_pens_eu %>% select(spdepb, year, values)

dt_spr_exp_pens_eu <- dt_spr_exp_pens_eu %>% filter(spdepb != 'TOTAL')

dt_spr_exp_pens_eu <- dt_spr_exp_pens_eu %>%
  mutate(type = case_when(
    .$spdepb == 'SCPOLDPEN' ~ 'Old age pension',
    .$spdepb == 'SCPANTPEN' ~ 'Anticipated old age pension',
    .$spdepb == 'SCPPARPEN' ~ 'Partial pension',
    .$spdepb == 'SCPDISPEN' ~ 'Disability pension',
    .$spdepb == 'SCPEARLYRED' ~ 'Early retirement benefit due to reduced capacity to work',
    .$spdepb == 'SCPSURVPEN' ~ 'Survivors pension',
    TRUE ~ 'Early retirement benefit for labour market reasons'))

dt_spr_exp_pens_eu <- dt_spr_exp_pens_eu %>% select(type, year, values)

ggplotly(
  ggplot(dt_spr_exp_pens_eu, aes(year, values, color=type)) +
    ggtitle('Europe - Pensions') +
    geom_line() +
    labs(x="Year", y="Percentage of gross domestic product") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


### General government expenditure by function

```{r General government expenditure by function (COFOG),echo=FALSE,message=FALSE,warning=FALSE,out.width=1024, out.height=700}
dt_gov_10a_exp <- get_eurostat("gov_10a_exp", stringsAsFactors = FALSE)

dt_gov_10a_exp_it <- dt_gov_10a_exp %>% filter(geo == 'IT')

dt_gov_10a_exp_it <- dt_gov_10a_exp_it %>% filter(unit == 'PC_GDP')

dt_gov_10a_exp_it <- dt_gov_10a_exp_it %>% filter(na_item == 'TE')

dt_gov_10a_exp_it <- dt_gov_10a_exp_it %>% filter(sector == 'S13')

dt_gov_10a_exp_it <- dt_gov_10a_exp_it %>% mutate(year = year(time))

dt_gov_10a_exp_it <- dt_gov_10a_exp_it %>% select(cofog99, year, values)

dt_gov_10a_exp_it <- dt_gov_10a_exp_it %>% 
  filter(cofog99 %in% c('GF01', 'GF02', 'GF03', 'GF04', 'GF05', 'GF06', 'GF07', 'GF08', 'GF09', 'GF10'))

dt_gov_10a_exp_it <- dt_gov_10a_exp_it %>%
  mutate(type = case_when(
    .$cofog99 == 'GF01' ~ 'General public services',
    .$cofog99 == 'GF02' ~ 'Defence',
    .$cofog99 == 'GF03' ~ 'Public order and safety',
    .$cofog99 == 'GF04' ~ 'Economic affairs',
    .$cofog99 == 'GF05' ~ 'Environmental protection',
    .$cofog99 == 'GF06' ~ 'Housing and community amenities',
    .$cofog99 == 'GF07' ~ 'Health',
    .$cofog99 == 'GF08' ~ 'Recreation, culture and religion',
    .$cofog99 == 'GF09' ~ 'Education',
    TRUE ~ 'Social protection'))

dt_gov_10a_exp_it <- dt_gov_10a_exp_it %>% select(type, year, values)

ggplotly(
  ggplot(dt_gov_10a_exp_it, aes(year, values, color=type)) +
    ggtitle('Italy - Government finance and statistics') +
    geom_line() +
    labs(x="Year", y="Percentage of gross domestic product") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)

dt_gov_10a_exp_eu <- dt_gov_10a_exp %>% filter(geo == 'EU27_2020')

dt_gov_10a_exp_eu <- dt_gov_10a_exp_eu %>% filter(unit == 'PC_GDP')

dt_gov_10a_exp_eu <- dt_gov_10a_exp_eu %>% filter(na_item == 'TE')

dt_gov_10a_exp_eu <- dt_gov_10a_exp_eu %>% filter(sector == 'S13')

dt_gov_10a_exp_eu <- dt_gov_10a_exp_eu %>% mutate(year = year(time))

dt_gov_10a_exp_eu <- dt_gov_10a_exp_eu %>% select(cofog99, year, values)

dt_gov_10a_exp_eu <- dt_gov_10a_exp_eu %>%
  mutate(type = case_when(
    .$cofog99 == 'GF01' ~ 'General public services',
    .$cofog99 == 'GF02' ~ 'Defence',
    .$cofog99 == 'GF03' ~ 'Public order and safety',
    .$cofog99 == 'GF04' ~ 'Economic affairs',
    .$cofog99 == 'GF05' ~ 'Environmental protection',
    .$cofog99 == 'GF06' ~ 'Housing and community amenities',
    .$cofog99 == 'GF07' ~ 'Health',
    .$cofog99 == 'GF08' ~ 'Recreation, culture and religion',
    .$cofog99 == 'GF09' ~ 'Education',
    TRUE ~ 'Social protection'))

dt_gov_10a_exp_eu <- dt_gov_10a_exp_eu %>% select(type, year, values)

ggplotly(
  ggplot(dt_gov_10a_exp_eu, aes(year, values, color=type)) +
    ggtitle('Europe - Government finance and statistics') +
    geom_line() +
    labs(x="Year", y="Percentage of gross domestic product") + 
    theme_bw() +
    theme(legend.position = 'top')
) %>%
  layout(legend = list(
    orientation = "h", x = 0, y =-0.2
  )
)
```


